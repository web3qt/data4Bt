# Binance 数据下载状态查询指南

## 概述

本项目现在支持实时查询数据下载状态，帮助您了解每个代币的下载进度，确保在任务中断后能够准确恢复。

## 使用方法

### 1. 命令行方式

#### 基本状态查询
```bash
go run cmd/main.go -cmd=status
```

#### 详细状态查询
```bash
go run cmd/main.go -cmd=status -detailed
```

#### 查询特定代币
```bash
# 单个代币
go run cmd/main.go -cmd=status -symbols=BTCUSDT

# 多个代币
go run cmd/main.go -cmd=status -symbols=BTCUSDT,ETHUSDT,BNBUSDT

# 特定代币的详细信息
go run cmd/main.go -cmd=status -symbols=BTCUSDT -detailed
```

### 2. 便捷脚本方式

我们提供了一个便捷的脚本 `status.sh`，使用更加简单：

#### 基本用法
```bash
# 查看所有代币状态
./status.sh

# 查看详细状态
./status.sh -d

# 查看特定代币
./status.sh BTCUSDT

# 查看多个代币
./status.sh BTCUSDT,ETHUSDT

# 查看特定代币的详细状态
./status.sh BTCUSDT -d

# 查看帮助
./status.sh -h
```

## 状态信息说明

### 基本模式显示内容
- **代币**: 交易对名称（如 BTCUSDT）
- **最后日期**: 最后处理的数据日期
- **已完成**: 已成功处理的文件数量
- **状态**: 当前处理状态

### 详细模式额外显示
- **失败**: 处理失败的文件数量
- **最后更新**: 状态最后更新时间

### 状态类型
- **已处理**: 该代币的数据处理已完成
- **进行中**: 该代币的数据正在处理中
- **失败**: 该代币的数据处理出现错误

## 数据存储位置

状态信息存储在 `state/progress.json` 文件中，包含：
- 每个代币的处理进度
- 最后处理日期
- 成功和失败的任务数量
- 最后更新时间

## 实用场景

### 1. 检查下载完整性
```bash
# 检查 BTC 1分钟数据是否完整
./status.sh BTCUSDT -d
```

### 2. 监控下载进度
```bash
# 查看所有代币的整体进度
./status.sh
```

### 3. 故障排查
```bash
# 查看详细状态，包括失败任务
./status.sh -d
```

### 4. 重启后检查
```bash
# 程序重启后，检查哪些任务需要继续
./status.sh
```

## 注意事项

1. **状态持久化**: 状态信息会自动保存到文件，程序重启后会自动加载
2. **实时更新**: 状态信息在数据处理过程中实时更新
3. **断点续传**: 基于状态信息，程序可以从中断点继续下载
4. **数据验证**: 状态中的"最后日期"表示已验证并成功导入的最新数据日期

## 示例输出

```
=== Binance 数据下载状态 ===

已完成任务: 60
代币数量: 10

代币           最后日期         已完成      状态      
---------------------------------------------
BTCUSDT      2024-12-19   6        已处理     
ETHUSDT      2024-12-19   6        已处理     
BNBUSDT      2024-12-19   6        已处理     
...
```

通过这些工具，您可以随时了解数据下载的准确状态，确保数据的完整性和连续性。